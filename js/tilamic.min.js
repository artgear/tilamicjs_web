/*

 tilamic.js
 ver. 1.0.0

 Copyright 2014 Artgear
 http://d.hatena.ne.jp/artgear/
 https://github.com/artgear/tilamicjs

 This software is released under the MIT License.
*/
(function(r,c){var t=function(b){var a=["Moz","Webkit","O","ms"],d=null,c=b.charAt(0).toUpperCase()+b.slice(1),f=document.createElement("div");if(b in f.style)return!0;for(b=0;b<a.length;b++)if(d=a[b]+c,d in f.style)return!0;return!1},w=document.all&&!document.querySelectorAll,x=document.all&&!document.addEventListener,m=function(b,a){var d=this.$ele=c(b);if(1!==d.length)throw Error("Selector Error.");a=this.options=c.extend({},{width:"100%",height:"100%",duration:"500ms",imgTop:0,imgLeft:0,importImgPaths:{},
attrPrefix:"",imgWidth:"auto",imgHeight:"auto"},a);this.classNames={face:a.attrPrefix+"tilamic_tile_face",backX:a.attrPrefix+"tilamic_tile_backX",backY:a.attrPrefix+"tilamic_tile_backY"};for(v in this.classNames)if(!/^[_a-zA-Z][_a-zA-Z0-9-]+$/.test(this.classNames[v]))throw Error("Invalid attrPrefix");var e={};d.find("img").each(function(a){e[a]=c(this).get(0).src;var b=c(this).attr("alt");b&&(e[b]=e[a])});this.imgPaths=e=c.extend({},e,a.importImgPaths);var f={position:"relative",width:a.width,height:a.height,
border:0,padding:0,margin:0},g={display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0,padding:0,margin:0,"background-size":a.imgWidth+"px "+a.imgHeight+"px","transition-property":"transform","-webkit-transition-property":"-webkit-transform","-o-transition-property":"-o-transform","-moz-transition-property":"-moz-transform","transition-duration":a.duration,"transform-style":"preserve-3d","backface-visibility":"hidden","background-position":a.imgLeft+" "+a.imgTop},l=c.extend({transform:"perspective(1000px) rotateX(-180deg) rotateY(0deg)"},
g),k=c.extend({transform:"perspective(1000px) rotateX(0deg) rotateY(-180deg)"},g);this._currentImgID="0";d.html("\x3c!-- This section is built by Tile constructor of tilamic.js automatically. --\x3e");f=c("<div>").css(f);g=c("<span>").addClass(this.classNames.face).css(g).css("background-image","url("+e[0]+")");l=c("<span>").addClass(this.classNames.backX).css(l).css("background-image","url("+e[1]+")");k=c("<span>").addClass(this.classNames.backY).css(k).css("background-image","url("+e[1]+")");f.append(g).append(l).append(k).appendTo(d);
var s=this;d.find("span").on({"webkitTransitionEnd transitionend":function(b){.1>=b.originalEvent.elapsedTime||!c(this).hasClass(s.classNames.face)||d.find("span").each(function(a){a=c(this).hasClass(s.classNames.face)?"perspective(1000px) rotateX(0deg) rotateY(0deg)":c(this).hasClass(s.classNames.backX)?"perspective(1000px) rotateX(-180deg) rotateY(0deg)":"perspective(1000px) rotateX(0deg) rotateY(-180deg)";c(this).css({"transition-duration":"0s",transform:a})}).delay(50).queue(function(){c(this).css({"transition-duration":a.duration}).dequeue()})}})};
m.prototype.getCurrentImgID=function(){return this._currentImgID};m.prototype.setInnerTileCss=function(b,a){this.$ele.find("span").css(b,a)};m.prototype.flip=function(b,a,d){var e=this.$ele,f=a?this.classNames.backX:this.classNames.backY,g=this.classNames.face;e.find("."+f).css("background-image","url("+this.imgPaths[b]+")");e.find("span").each(function(b){((b=c(this).hasClass(g))||c(this).hasClass(f))&&c(this).css({transform:"perspective(1000px) rotateX("+(a?b?d?-180:180:d?-360:0:0)+"deg) rotateY("+
(a?0:b?d?-180:180:d?-360:0)+"deg)"}).toggleClass(g+" "+f)});this._currentImgID=b};m.prototype.flipX=function(b,a){this.flip(b,!0,a)};m.prototype.flipY=function(b,a){this.flip(b,!1,a)};var n=function(b,a){var d=this.$ele=c(b);if(1!==d.length)throw Error("Selector Error.");a=this.options=c.extend({},{width:"100%",height:"100%",duration:"500ms",imgTop:0,imgLeft:0,importImgPaths:{},attrPrefix:"",imgWidth:"auto",imgHeight:"auto"},a);this.classNames={face:a.attrPrefix+"tilamic_tile_face",back:a.attrPrefix+
"tilamic_tile_back"};for(v in this.classNames)if(!/^[_a-zA-Z][_a-zA-Z0-9-]+$/.test(this.classNames[v]))throw Error("Invalid attrPrefix");var e={};d.find("img").each(function(a){e[a]=c(this).get(0).src;var b=c(this).attr("alt");b&&(e[b]=e[a])});this.imgPaths=e=c.extend({},e,a.importImgPaths);var f={position:"relative",width:a.width,height:a.height,border:0,padding:0,margin:0,overflow:"hidden"},g={"vertical-align":"top",position:"absolute",top:a.imgTop,left:a.imgLeft,width:a.imgWidth,height:a.imgHeight},
l=c.extend({display:"inline"},g),g=c.extend({display:"none"},g);this._currentImgID="0";d.html("\x3c!-- This section is built by AltTile constructor of tilamic.js automatically. --\x3e");$tileWrapper=c("<div>").css(f);$tileFace=c("<img />").addClass(this.classNames.face).css(l).attr("src",e[0]);$tileBack=c("<img />").addClass(this.classNames.back).css(g).attr("src",e[1]);$tileWrapper.append($tileFace).append($tileBack).appendTo(d)};n.prototype.getCurrentImgID=function(){return this._currentImgID};
n.prototype.setInnerTileCss=function(b,a){this.$ele.find("img").css(b,a)};n.prototype.fade=function(b){$ele=this.$ele;var a=this.classNames.face,d=this.classNames.back;$ele.find("."+d).attr("src",this.imgPaths[b]).fadeIn();$ele.find("."+a).fadeOut();$ele.find("img").toggleClass(a+" "+d);this._currentImgID=b};n.prototype.replace=function(b){$ele=this.$ele;$ele.find("."+this.classNames.face).attr("src",this.imgPaths[b]);this._currentImgID=b};n.prototype.flip=function(b,a,d){x?this.replace(b):this.fade(b)};
var h=function(b,a){var d=this.$ele=c(b);d.find("img").eq(0);var e={rows:3,cols:3,attrPrefix:"",aspectRatio:0,isCSS3Supported:t("transition")&&t("transform")};this.options=c.extend({},e,a);this.options.aspectRatio&&d.css("height",Math.round(d.width()*this.options.aspectRatio));var f={};d.find("img").each(function(a){f[a]=c(this).get(0).src;var b=c(this).attr("alt");b&&(f[b]=f[a])});var e={border:0,padding:0,margin:0,"line-height":0,"list-style-type":"none",width:"105%"},g={border:0,padding:0,margin:0,
display:w?"inline":"inline-block",zoom:1};this._computeTileSize=function(a,b){var c=Math.floor(a?d.width():d.height()),e=this.options[a?"cols":"rows"];return Math.floor(c/e)+(b<c%e?1:0)};var l=c.proxy(this._computeTileSize,this);this._computeImgPos=function(a,b){var c=a?d.width():d.height(),e=this.options[a?"cols":"rows"];return-1*(Math.floor(c/e)*b+Math.min(b,c%e))+"px"};var k=c.proxy(this._computeImgPos,this),h=this.tiles=[],y=this.options.isCSS3Supported?m:n;d.html("\x3c!-- This section is built by Tilamic constructor of tilamic.js automatically. --\x3e");
for(var p=0;p<this.options.rows;p++){for(var u=c("<ul>").css(e),q=0;q<this.options.cols;q++){var r=c("<li>").css({width:l(!0,q),height:l(!1,p)}).css(g).appendTo(u);h.push({row:p,col:q,isActive:!0,"origin-x":"50%","origin-y":"50%",tileObject:new y(r,{imgTop:k(!1,p),imgLeft:k(!0,q),imgWidth:d.width(),imgHeight:d.height(),importImgPaths:f,attrPrefix:this.options.attrPrefix})})}u.appendTo(d)}};h.prototype._controlOrigin=function(b){c.each(this.tiles,function(a,b){b.isActive&&b.tileObject.setInnerTileCss({"transform-origin":b["origin-x"]+
" "+b["origin-y"]+" 0"})})};h.prototype.flip=function(b,a){a=c.extend({},{isAxisX:!1,isReverse:!1},a);this._controlOrigin();c.each(this.tiles,function(c,e){e.isActive&&e.tileObject.flip(b,a.isAxisX,a.isReverse)})};h.prototype.seqFlip=function(b,a){a=c.extend({},{delay:100,isAxisX:!1,isReverse:!1,isZtoA:!1},a);this._controlOrigin();var d=a.isZtoA?this.tiles.length:0;c.each(this.tiles,function(c,f){f.isActive&&(setTimeout(function(){f.tileObject.flip(b,a.isAxisX,a.isReverse)},d*a.delay),a.isZtoA?d--:
d++)})};h.prototype.filter=function(b){var a=c.extend(!0,{},this);c.each(a.tiles,function(a,c){c.isActive&&(c.isActive=b(a,c.col,c.row))});return a};h.prototype.setOrigin=function(b){var a=function(a){var b=function(b,c){return 100*a.options[b?"cols":"rows"]/2-100*c+"%"};return{each:function(a,b,c){return"50%"},centerOfAll:function(a,c,d){return a?b(a,c):b(a,d)},centerOfRow:function(a,c,d){return a?b(a,c):"50%"},middleOfCol:function(a,c,d){return a?"50%":b(a,d)}}}(this),d=c.extend(!0,{},this);if(!(b in
a&&this.options.isCSS3Supported))return d;c.each(d.tiles,function(c,d){d["origin-x"]=a[b](!0,d.col,d.row);d["origin-y"]=a[b](!1,d.col,d.row)});return d};h.prototype.resize=function(){$ele=this.$ele;var b=$ele.width();$ele.css("height",Math.round(b*this.options.aspectRatio));var a=c.proxy(this._computeTileSize,this);$ele.find("ul").each(function(b){c(this).find("li").each(function(d){c(this).css({width:a(!0,d),height:a(!1,b)})})});for(var d=b=null,e=this.tiles,f=c.proxy(this._computeImgPos,this),g=
this.options.isCSS3Supported,h=g?{"background-size":$ele.width()+"px "+$ele.height()+"px"}:{width:$ele.width()+"px",height:$ele.height()+"px"},k=0;k<e.length;k++)b=e[k],d=c.extend(g?{"background-position":f(!0,b.col)+" "+f(!1,b.row)}:{top:f(!1,b.row),left:f(!0,b.col)},h),b.tileObject.setInnerTileCss(d)};h.prototype.getCurrentImgID=function(b){b=b||0;0>b&&(b+=this.tiles.length);if(!(0<=b&&b<this.tiles.length))throw Error("Index Error");return this.tiles[b].tileObject.getCurrentImgID()};h.prototype.on=
function(b,a,d){$tileLi=this.$ele.find("li");"function"===c.type(a)&&(d=a,a={});c.each(this.tiles,function(e,f){if(f.isActive)$tileLi.eq(e).on(b,c.extend({},{tileIndex:e},a),d)})};r.Tilamic=h})(window,jQuery);
